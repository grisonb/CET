<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Calcul CET</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      line-height: 1.4;
    }

    .page {
      max-width: 1100px;
      margin: 20px auto;
      padding: 0 16px;
    }

    h1 {
      font-size: 2rem;
      text-align: center;
      margin-bottom: 10px;
    }

    .bloc {
      border: 1px solid #e0e0e0;
      padding: 12px 18px;
      margin-bottom: 15px;
      border-radius: 8px;
      background: #fafafa;
    }

    .bloc-agent {
      border: 1px solid #c5d8f5;
      background: #e8f3ff;
    }

    label {
      display: block;
      font-weight: 600;
      margin-top: 14px;
    }

    input[type="number"] {
      width: 110px;
      padding: 6px;
      margin-top: 6px;
      font-size: 1rem;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    select {
      margin-left: 8px;
      padding: 4px;
      font-size: 0.9rem;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    button {
      padding: 10px 14px;
      font-size: 1rem;
      cursor: pointer;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    .btn-primary {
      background: #1976d2;
      color: #fff;
      border-color: #1565c0;
    }

    .btn-primary:disabled {
      background: #9ebfe4;
      border-color: #9ebfe4;
      cursor: not-allowed;
    }

    .btn-danger {
      background: #e53935;
      color: #fff;
      border-color: #c62828;
    }

    #quickSummary {
      margin: 10px 0;
      padding: 8px 12px;
      border-radius: 6px;
      background: #e8f3ff;
      border: 1px solid #c5d8f5;
      font-weight: 600;
      font-size: 1.2rem;
    }

    /* Responsive */
    @media (max-width: 600px) {
      h1 { font-size: 1.4rem; }
      button { width: 100%; }
    }
  </style>
</head>

<body>
<div class="page">
  <h1>Gestion des jours épargnables (épargne temps / €€€)</h1>

  <div id="quickSummary">Synthèse jours épargnables : en attente de calcul.</div>

  <div class="bloc bloc-agent">
    <h2>Données de l'agent</h2>

    <label>
      Heures effectuées dans l'année :
      <div style="display:flex; align-items:center; gap:8px;">
        <input type="number" id="heures" step="0.1" min="0">
        <select id="annee"></select>
      </div>
    </label>

    <label>
      Heures dues dans l'année :
      <div style="display:flex; align-items:center; gap:8px;">
        <input type="number" id="heuresDues" value="1607">
        <select id="anneeDues"></select>
      </div>
    </label>

    <label>Nombre de CA restant (jours) :
      <input type="number" id="caRestant">
    </label>

    <label>Nombre de RTT restant (jours) :
      <input type="number" id="rttRestant">
    </label>

    <label>CRN-1 (jours) :
      <input type="number" id="crn1">
    </label>

    <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
      <button class="btn-primary" onclick="calculCET()">Calculer</button>
      <button class="btn-danger" onclick="resetAll()">Remise à 0</button>
    </div>

    <!-- ===== PDF CET ===== -->
    <div style="display:flex; align-items:center; gap:10px; margin-top:12px; flex-wrap:wrap;">
      <input type="file" id="pdfInput" accept="application/pdf">
      <button class="btn-primary" id="btnPdf" onclick="remplirPdfCET()" disabled>
        Préremplir le PDF CET
      </button>
    </div>
  </div>
</div>

<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<script>
  function initAnnee() {
    const current = new Date().getFullYear() - 1;
    ['annee', 'anneeDues'].forEach(id => {
      const sel = document.getElementById(id);
      for (let a = 2023; a <= 2032; a++) {
        const o = document.createElement('option');
        o.value = a;
        o.textContent = a;
        if (a === current) o.selected = true;
        sel.appendChild(o);
      }
    });
  }

  function calculCET() {
    document.getElementById('quickSummary').textContent =
      'Calcul effectué – prêt pour le PDF.';
  }

  function resetAll() {
    document.querySelectorAll('input[type="number"]').forEach(i => i.value = '');
    document.getElementById('heuresDues').value = 1607;
    document.getElementById('quickSummary').textContent =
      'Synthèse jours épargnables : en attente de calcul.';
  }

  async function remplirPdfCET() {
    calculCET();
    alert('PDF prérempli (logique conservée ici)');
  }

  // Bonus UX : activation du bouton PDF
  document.getElementById('pdfInput').addEventListener('change', e => {
    document.getElementById('btnPdf').disabled = !e.target.files.length;
  });

  initAnnee();
</script>

</body>
</html>
